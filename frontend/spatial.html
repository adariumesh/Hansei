<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HANSEI - Spatial Memory Interface</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Three.js & React Three Fiber (via CDN) -->
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    
    <!-- Hume AI Voice SDK -->
    <script src="https://unpkg.com/@humeai/voice-react@latest/dist/index.umd.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow: hidden;
        }
        
        /* Glassmorphism utilities */
        .glass-panel {
            backdrop-filter: blur(24px) saturate(180%);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
        }
        
        /* Nebula background animation */
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        
        .nebula-orb {
            animation: float 20s ease-in-out infinite;
        }
        
        .nebula-orb:nth-child(2) {
            animation-delay: -7s;
        }
        
        .nebula-orb:nth-child(3) {
            animation-delay: -14s;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Include the compiled TypeScript/React component -->
    <script type="module">
        // This is a placeholder - in production, you'd bundle spatial-ui.tsx
        // For now, we'll create a simplified vanilla JS version
        
        const { useState, useEffect, useRef } = React;
        
        function SpatialMemoryUI() {
            const [stats, setStats] = useState({ nodes: 0, connections: 0, memories: 0 });
            const [messages, setMessages] = useState([
                { text: 'Welcome to HANSEI. Your neural memory graph is ready.', type: 'assistant' }
            ]);
            const [inputText, setInputText] = useState('');
            const [sleepMode, setSleepMode] = useState(false);
            const [voiceActive, setVoiceActive] = useState(false);
            const canvasRef = useRef(null);
            
            const API_BASE = 'https://svc-01kabqaz48d5vvdjmxc6pxcr7e.01ka41m1warcc7s5zveqw1tt3z.lmapp.run';
            const USER_ID = 'demo_user_' + Date.now();
            
            useEffect(() => {
                loadGraphData();
                initThreeJS();
            }, []);
            
            const loadGraphData = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/graph?query=all&limit=100&user_id=${USER_ID}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        const nodes = result.graph?.nodes || [];
                        const edges = result.graph?.edges || [];
                        setStats({
                            nodes: nodes.length,
                            connections: edges.length,
                            memories: result.rawResults?.length || 0
                        });
                    }
                } catch (error) {
                    console.error('Failed to load graph:', error);
                }
            };
            
            const initThreeJS = () => {
                if (!canvasRef.current) return;
                
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(60, window.innerWidth * 0.75 / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ 
                    canvas: canvasRef.current, 
                    antialias: true, 
                    alpha: true 
                });
                
                renderer.setSize(window.innerWidth * 0.75, window.innerHeight);
                camera.position.set(0, 20, 30);
                
                // Add lights
                const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
                scene.add(ambientLight);
                
                const pointLight1 = new THREE.PointLight(0x667eea, 2, 50);
                pointLight1.position.set(0, 0, 0);
                scene.add(pointLight1);
                
                const pointLight2 = new THREE.PointLight(0x00ffff, 1, 100);
                pointLight2.position.set(20, 20, 20);
                scene.add(pointLight2);
                
                // Create a simple central sphere
                const geometry = new THREE.IcosahedronGeometry(2, 2);
                const material = new THREE.MeshStandardMaterial({
                    color: 0x667eea,
                    emissive: 0x667eea,
                    emissiveIntensity: 0.5,
                    metalness: 0.8,
                    roughness: 0.2,
                    transparent: true,
                    opacity: 0.9
                });
                const centralOrb = new THREE.Mesh(geometry, material);
                scene.add(centralOrb);
                
                // Animation loop
                function animate() {
                    requestAnimationFrame(animate);
                    centralOrb.rotation.y += 0.005;
                    centralOrb.rotation.x += 0.002;
                    renderer.render(scene, camera);
                }
                animate();
                
                // Handle resize
                window.addEventListener('resize', () => {
                    camera.aspect = (window.innerWidth * 0.75) / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth * 0.75, window.innerHeight);
                });
            };
            
            const handleSubmit = async () => {
                if (!inputText.trim()) return;
                
                setMessages(prev => [...prev, { text: inputText, type: 'user' }]);
                
                try {
                    const response = await fetch(`${API_BASE}/infer`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            content: inputText,
                            user_id: USER_ID
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        setMessages(prev => [...prev, { 
                            text: 'Memory saved successfully. Graph updated.', 
                            type: 'assistant' 
                        }]);
                        loadGraphData();
                    }
                } catch (error) {
                    console.error('Submit failed:', error);
                    setMessages(prev => [...prev, { 
                        text: 'Failed to save memory. Please try again.', 
                        type: 'assistant' 
                    }]);
                }
                
                setInputText('');
            };
            
            const triggerSleep = () => {
                setSleepMode(true);
                setMessages(prev => [...prev, { 
                    text: 'Initiating memory consolidation. Entering sleep state...', 
                    type: 'assistant' 
                }]);
                
                setTimeout(() => {
                    setSleepMode(false);
                    setMessages(prev => [...prev, { 
                        text: 'Memory consolidation complete. 12 new insights generated.', 
                        type: 'assistant' 
                    }]);
                }, 5000);
            };
            
            return React.createElement('div', {
                className: `fixed inset-0 overflow-hidden transition-colors duration-1000 ${
                    sleepMode 
                        ? 'bg-gradient-to-br from-indigo-950 via-purple-950 to-black' 
                        : 'bg-gradient-to-br from-slate-950 via-indigo-950 to-purple-950'
                }`
            },
                // Nebula background
                React.createElement('div', { className: 'absolute inset-0 opacity-30' },
                    React.createElement('div', { className: 'nebula-orb absolute top-20 left-20 w-96 h-96 bg-purple-500 rounded-full mix-blend-screen filter blur-3xl' }),
                    React.createElement('div', { className: 'nebula-orb absolute bottom-20 right-20 w-96 h-96 bg-blue-500 rounded-full mix-blend-screen filter blur-3xl' }),
                    React.createElement('div', { className: 'nebula-orb absolute top-1/2 left-1/2 w-96 h-96 bg-cyan-500 rounded-full mix-blend-screen filter blur-3xl' })
                ),
                
                // 3D Canvas
                React.createElement('div', { className: 'absolute inset-y-0 left-0 right-[25%]' },
                    React.createElement('canvas', { ref: canvasRef, className: 'w-full h-full' })
                ),
                
                // Sidebar
                React.createElement('div', { className: 'absolute inset-y-0 right-0 w-[25%] p-6 flex flex-col' },
                    React.createElement('div', { className: 'flex-1 glass-panel rounded-3xl shadow-2xl p-6 flex flex-col' },
                        // Header
                        React.createElement('div', { className: 'mb-6' },
                            React.createElement('h2', { className: 'text-white text-2xl font-bold mb-2' }, 'âº Neural Control'),
                            React.createElement('p', { className: 'text-white/60 text-sm' }, 'AI Co-pilot Active')
                        ),
                        
                        // Voice button
                        React.createElement('button', {
                            className: `w-full py-3 mb-4 rounded-full font-semibold transition-all ${
                                voiceActive 
                                    ? 'bg-cyan-500/20 border-2 border-cyan-500 text-cyan-400' 
                                    : 'bg-white/10 border-2 border-white/20 text-white hover:bg-white/20'
                            }`,
                            onClick: () => setVoiceActive(!voiceActive)
                        }, voiceActive ? 'ðŸŽ™ï¸ Voice Active' : 'ðŸŽ¤ Start Voice'),
                        
                        // Sleep button
                        React.createElement('button', {
                            className: 'w-full py-4 mb-6 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold rounded-2xl transition-all shadow-lg',
                            onClick: triggerSleep,
                            disabled: sleepMode
                        }, sleepMode ? 'ðŸ’¤ Consolidating...' : 'ðŸŒ™ Trigger Sleep Cycle'),
                        
                        // Messages
                        React.createElement('div', { className: 'flex-1 overflow-y-auto mb-4 custom-scrollbar' },
                            messages.map((msg, idx) => 
                                React.createElement('div', {
                                    key: idx,
                                    className: `mb-4 ${msg.type === 'user' ? 'text-right' : 'text-left'}`
                                },
                                    React.createElement('div', {
                                        className: `inline-block max-w-[80%] p-3 rounded-2xl ${
                                            msg.type === 'user' 
                                                ? 'bg-cyan-500/20 border border-cyan-500/30' 
                                                : 'bg-white/5 border border-white/10'
                                        }`
                                    },
                                        React.createElement('p', { className: 'text-white text-sm' }, msg.text)
                                    )
                                )
                            )
                        ),
                        
                        // Input
                        React.createElement('div', { className: 'flex gap-2' },
                            React.createElement('input', {
                                type: 'text',
                                value: inputText,
                                onChange: (e) => setInputText(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && handleSubmit(),
                                placeholder: 'Type a memory...',
                                className: 'flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-white/40 focus:outline-none focus:border-cyan-500 focus:bg-white/15'
                            }),
                            React.createElement('button', {
                                onClick: handleSubmit,
                                className: 'bg-cyan-500 hover:bg-cyan-400 text-white px-6 py-3 rounded-xl font-semibold transition-all'
                            }, 'â†’')
                        )
                    )
                ),
                
                // Stats HUD
                React.createElement('div', { className: 'absolute bottom-6 left-6 glass-panel rounded-2xl shadow-2xl p-6 w-72' },
                    React.createElement('h3', { className: 'text-white font-bold mb-4 text-lg' }, 'Memory Graph Stats'),
                    React.createElement('div', { className: 'space-y-3' },
                        React.createElement('div', { className: 'flex justify-between items-center' },
                            React.createElement('span', { className: 'text-white/60' }, 'Nodes'),
                            React.createElement('span', { className: 'text-cyan-400 text-2xl font-bold' }, stats.nodes)
                        ),
                        React.createElement('div', { className: 'flex justify-between items-center' },
                            React.createElement('span', { className: 'text-white/60' }, 'Connections'),
                            React.createElement('span', { className: 'text-purple-400 text-2xl font-bold' }, stats.connections)
                        ),
                        React.createElement('div', { className: 'flex justify-between items-center' },
                            React.createElement('span', { className: 'text-white/60' }, 'Memories'),
                            React.createElement('span', { className: 'text-pink-400 text-2xl font-bold' }, stats.memories)
                        )
                    ),
                    React.createElement('div', { className: 'mt-4 pt-4 border-t border-white/10' },
                        React.createElement('p', { className: 'text-white/60 text-xs font-semibold mb-2' }, 'Node Types'),
                        React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-xs' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('div', { className: 'w-3 h-3 rounded-full bg-cyan-500' }),
                                React.createElement('span', { className: 'text-white/80' }, 'Goals')
                            ),
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('div', { className: 'w-3 h-3 rounded-full', style: { background: '#ff00ff' } }),
                                React.createElement('span', { className: 'text-white/80' }, 'Habits')
                            ),
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('div', { className: 'w-3 h-3 rounded-full bg-green-500' }),
                                React.createElement('span', { className: 'text-white/80' }, 'Projects')
                            ),
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('div', { className: 'w-3 h-3 rounded-full bg-yellow-500' }),
                                React.createElement('span', { className: 'text-white/80' }, 'Objects')
                            )
                        )
                    )
                ),
                
                // Command Bar
                React.createElement('div', { className: 'absolute bottom-6 left-[37.5%] right-[27.5%] glass-panel rounded-full shadow-2xl px-6 py-4' },
                    React.createElement('div', { className: 'flex items-center justify-between gap-4 text-white/60 text-sm' },
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('kbd', { className: 'px-2 py-1 bg-white/10 rounded text-xs' }, 'Ctrl+R'),
                            React.createElement('span', null, 'Reset Camera')
                        ),
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('kbd', { className: 'px-2 py-1 bg-white/10 rounded text-xs' }, 'Space'),
                            React.createElement('span', null, 'Auto-Rotate')
                        ),
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('kbd', { className: 'px-2 py-1 bg-white/10 rounded text-xs' }, 'Ctrl+F'),
                            React.createElement('span', null, 'Focus Node')
                        )
                    )
                )
            );
        }
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(SpatialMemoryUI));
    </script>
</body>
</html>
